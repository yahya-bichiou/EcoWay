{% extends 'base.html.twig' %}

{% block title %}Modifier le Profil{% endblock %}

{% block body %}
<div class="container mt-5">
    <h2 class="mb-4">Modifier le Profil</h2>

    {% for message in app.flashes('success') %}
        <div class="alert alert-success">{{ message }}</div>
    {% endfor %}

    {# ✅ Disable HTML5 validation #}
    {{ form_start(form, {'attr': {'id': 'editProfileForm', 'novalidate': 'novalidate'}}) }}

    <div class="form-group">
        <div class="form-field">
            <span class="far fa-user"></span>
            {{ form_widget(form.name, {'attr': {'placeholder': 'Nom', 'id': 'editProfileName', 'class': 'form-control'}}) }}
        </div>
        <small class="text-danger" id="nameError">{{ form_errors(form.name) }}</small> {# ✅ Correct error display #}
    </div>

    <button type="submit" class="btn btn-primary">Enregistrer</button>
    <a href="{{ path('profile') }}" class="btn btn-secondary">Annuler</a>

    {{ form_end(form) }} {# ✅ Close the form #}
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    let form = document.getElementById("editProfileForm");

    if (form) {
        form.addEventListener("submit", function(event) {
            let nameField = document.getElementById("editProfileName");
            let nameError = document.getElementById("nameError");
            let hasError = false;

            nameError.textContent = ""; // Clear previous errors

            if (nameField.value.trim() === "") {
                nameError.textContent = "Veuillez entrer votre nom.";
                hasError = true;
            } else if (nameField.value.length < 3) {
                nameError.textContent = "Le nom doit contenir au moins 3 caractères.";
                hasError = true;
            }

            if (hasError) {
                event.preventDefault(); // Prevent form submission
            }
        });
    }
});
</script>

{% endblock %}
